<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- SEO OPTIMIZATION: Title Tag for Pharmacist-Formulated -->
    <title>Social Phix: Pharmacist-Formulated Supplement for Focus, Calmness, and Social Confidence</title>
    <!-- SEO OPTIMIZATION: Compliant Meta Description for high click-through rate -->
    <meta name="description" content="Social Phix is the Pharmacist-Formulated drink supplement that helps manage everyday nervousness and supports clear focus in social settings. Promote social confidence with L-Theanine and natural ingredients.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #2D184E;
            color: #ffffff;
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .btn-primary {
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(110, 201, 241, 0.4);
        }
        /* Custom style for FAQ answer background */
        .faq-answer {
            background-color: rgba(255, 255, 255, 0.03);
        }
    </style>
</head>
<body class="bg-[#2D184E] text-white">

    <!-- Header --><header class="p-6 md:p-8 flex justify-between items-center bg-[#2D184E] relative z-20">
        <!-- H1: Brand Name -->
        <h1 class="text-3xl font-bold text-[#6EC9F1] tracking-wide">Social Phix</h1>
        <a href="#waitlist" class="hidden sm:inline-block bg-[#6EC9F1] text-[#2D184E] font-semibold py-2 px-6 rounded-full shadow-lg hover:bg-sky-400 transition-colors duration-300">Get Your Phix Now</a>
    </header>

    <!-- Hero Section -->
    <section class="min-h-[80vh] flex items-center justify-center p-4 md:p-8 relative bg-gradient-to-br from-[#2D184E] to-[#3E216B]">
        <div class="container mx-auto max-w-7xl flex flex-col-reverse lg:flex-row items-center justify-between gap-12">
            <!-- Text Content -->
            <div class="text-center lg:text-left w-full lg:w-1/2 space-y-6">
                <!-- H2: Pharmacist-Formulated, Clinical Calm, Social Confidence (No Asterisk) -->
                <h2 class="text-4xl sm:text-5xl md:text-6xl font-extrabold tracking-tight leading-tight">Pharmacist-Formulated. Clinical Calm. Social Confidence.</h2>
                
                <!-- Tagline: Removed bolding (**) to eliminate all asterisks -->
                <p class="text-lg md:text-xl text-white/80 max-w-3xl mx-auto lg:mx-0">The natural supplement designed by experts to support composure and clear focus when you need it most. Manage feelings of nervousness and enjoy the conversation.</p>
                
                <div class="pt-4">
                    <a href="#waitlist" class="btn-primary inline-block bg-[#6EC9F1] text-[#2D184E] font-bold py-4 px-10 rounded-full shadow-lg hover:bg-sky-400 transition-all duration-300">Claim Early Access & Discount</a>
                </div>
            </div>
            <!-- Product Image - Corrected extension to .png -->
            <div class="w-full lg:w-1/2 flex justify-center lg:justify-end">
                <!-- TECHNICAL SEO: Added width and height for CLS prevention -->
                <img src="phix.png" alt="Social Phix bottle, a natural supplement drink that supports calm and social confidence." class="w-full max-w-md rounded-3xl shadow-2xl" width="400" height="400">
            </div>
        </div>
    </section>

    <!-- Benefits Section -->
    <section class="py-16 md:py-24 bg-[#3E216B]">
        <div class="container mx-auto px-4">
            <!-- H3 uses compliant keywords -->
            <h3 class="text-center text-3xl md:text-4xl font-bold mb-12">Social Phix: Supporting Your Social Composure</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                <div class="card p-8 rounded-2xl shadow-xl">
                    <div class="flex items-center justify-center w-16 h-16 rounded-full bg-white/10 mx-auto mb-4">
                        <svg class="w-8 h-8 text-[#6EC9F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    </div>
                    <h4 class="text-2xl font-semibold text-[#6EC9F1] mb-2">Clear Mental Focus</h4>
                    <p class="text-white/70 leading-relaxed">Supports sharp, focused thoughts in the present moment. Quiets the mental distraction that can accompany social nervousness.</p>
                </div>
                <div class="card p-8 rounded-2xl shadow-xl">
                    <div class="flex items-center justify-center w-16 h-16 rounded-full bg-white/10 mx-auto mb-4">
                        <svg class="w-8 h-8 text-[#6EC9F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <!-- Compliant language: 'Supports physical composure' -->
                    <h4 class="text-2xl font-semibold text-[#6EC9F1] mb-2">Physical Composure</h4>
                    <p class="text-white/70 leading-relaxed">Supports physical composure by easing tension, allowing you to connect authentically without the distraction of a racing heart or tense shoulders.</p>
                </div>
                <div class="card p-8 rounded-2xl shadow-xl">
                    <div class="flex items-center justify-center w-16 h-16 rounded-full bg-white/10 mx-auto mb-4">
                        <svg class="w-8 h-8 text-[#6EC9F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg>
                    </div>
                    <h4 class="text-2xl font-semibold text-[#6EC9F1] mb-2">Promotes Social Flow</h4>
                    <p class="text-white/70 leading-relaxed">Helps create that relaxed state where conversation flows naturally, boosting your social confidence and ability to speak freely.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Product Visuals Section (Scenarios) -->
    <section class="py-20 md:py-32 bg-[#2D184E]">
        <div class="container mx-auto px-4 text-center">
            <!-- H3: Compliant language focused on situations of nervousness -->
            <h3 class="text-3xl md:text-4xl font-bold mb-8">Take Social Phix when social nervousness strikes:</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Card 1: Before a Presentation/Speech - Corrected extension to .png -->
                <div class="card p-6 rounded-2xl shadow-xl flex flex-col items-center text-center">
                    <img src="speech.png" alt="Person preparing for a speech, using Social Phix for public speaking confidence and composed delivery." class="w-full h-56 object-cover rounded-xl mb-4" width="224" height="224">
                    <h4 class="text-xl font-semibold text-[#6EC9F1] mb-2">The Big Presentation</h4>
                    <p class="text-white/70 text-sm leading-relaxed">Supports sharp memory and composed delivery. Helps you turn nervous energy into confident articulation.</p>
                </div>
                
                <!-- Card 2: Nailing That Important Interview - Corrected extension to .png -->
                <div class="card p-6 rounded-2xl shadow-xl flex flex-col items-center text-center">
                    <img src="interview.png" alt="Taking Social Phix supplement for interview nerves to stay focused and articulate." class="w-full h-56 object-cover rounded-xl mb-4" width="224" height="224">
                    <h4 class="text-xl font-semibold text-[#6EC9F1] mb-2">The High-Stakes Interview</h4>
                    <p class="text-white/70 text-sm leading-relaxed">Stay articulate, clear-headed, and collected. Showcase your true potential without the mental fog.</p>
                </div>

                <!-- Card 3: Before a Blind Date or Social Event - Corrected extension to .png -->
                <div class="card p-6 rounded-2xl shadow-xl flex flex-col items-center text-center">
                    <img src="blind date.png" alt="A woman on a date, relaxed with the help of a natural confidence boost supplement, Social Phix." class="w-full h-56 object-cover rounded-xl mb-4" width="224" height="224">
                    <h4 class="text-xl font-semibold text-[#6EC9F1] mb-2">First Dates & Group Events</h4>
                    <p class="text-white/70 text-sm leading-relaxed">Helps remove self-consciousness. Enjoy genuine conversation and relaxed body language.</p>
                </div>

                <!-- Card 4: Dealing with Difficult People (New) - Corrected extension to .png -->
                <div class="card p-6 rounded-2xl shadow-xl flex flex-col items-center text-center">
                    <img src="difficult_people.png" alt="Staying calm during conflict, using Social Phix for social composure and assertiveness." class="w-full h-56 object-cover rounded-xl mb-4" width="224" height="224">
                    <h4 class="text-xl font-semibold text-[#6EC9F1] mb-2">Navigating Conflict</h4>
                    <p class="text-white/70 text-sm leading-relaxed">Supports maintaining composure in stressful conversations. Respond assertively without reacting emotionally.</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- AI Assistant Section: Neutral Look, Christian Backend -->
    <section id="ai-chat" class="py-16 md:py-24 bg-[#3E216B]">
        <div class="container mx-auto px-4 max-w-4xl">
            <!-- Neutral Heading -->
            <h3 class="text-3xl md:text-4xl font-bold mb-4 flex items-center justify-center">
                <!-- Neutral Icon -->
                <svg class="w-8 h-8 mr-2 text-[#F1E0B3]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14v4m0 0a1 1 0 00-1-1 1 1 0 00-1 1 1 1 0 001 1 1 1 0 001-1zm0 0l-1.5 1.5M10.5 19.5L9 21M12 21h.01M16 12a4 4 0 10-8 0 4 4 0 008 0zM5.9 7.8c-1.3-.9-2.3-2-2.9-3.2-.2-.5-.1-.8.2-1.1s.8-.2 1.3-.1c1.2.3 2.3 1.2 3.2 2.6l1.2 1.6zM18.1 7.8c1.3-.9 2.3-2 2.9-3.2.2-.5.1-.8-.2-1.1s-.8-.2-1.3-.1c-1.2.3-2.3 1.2-3.2 2.6l-1.2 1.6z"></path></svg>
                <span class="text-[#F1E0B3]">Guided Reflection: Finding Your Inner Anchor</span>
            </h3>
            <!-- Neutral Description -->
            <p class="text-lg max-w-2xl mx-auto mb-8 text-white/80">Need encouragement? The Assistant offers supportive words and guided reflection to help you find clarity and peace when dealing with feelings of worry or nervousness.</p>

            <div class="bg-white/5 p-6 rounded-3xl shadow-2xl">
                <!-- AI Input Form -->
                <div class="flex flex-col sm:flex-row gap-3 mb-6">
                    <!-- Neutral Placeholder -->
                    <input type="text" id="ai-question" placeholder="Ask, 'How can I stay calm before a big event?' or 'Give me a positive thought for today.'" 
                           class="flex-grow p-4 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-[#6EC9F1]">
                    <!-- Neutral Button Text -->
                    <button id="ask-ai-button" class="btn-primary flex-shrink-0 bg-[#6EC9F1] text-[#2D184E] font-bold py-3 px-8 rounded-xl shadow-lg hover:bg-sky-400 transition-all duration-300" onclick="askAI()">
                        Receive Reflection
                    </button>
                </div>

                <!-- AI Response Area -->
                <div id="ai-response" class="min-h-[100px] text-left p-4 rounded-xl border border-white/10 bg-[#2D184E]/50 text-white/90">
                    <p class="text-white/50">Your personal reflection and support will appear here.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Ingredients Section -->
    <section class="py-16 md:py-24 bg-[#2D184E]">
        <div class="container mx-auto px-4 text-center">
            <!-- H3 with compliant keyword 'natural support' -->
            <h3 class="text-3xl md:text-4xl font-bold mb-8">Natural Ingredients for Social Support</h3>
            <p class="text-lg max-w-3xl mx-auto mb-12 text-white/80">Social Phix is formulated with a synergistic blend of natural ingredients, including high-dose L-Theanine and Motherwort, each chosen to support a calm, focused, and present state of mind.</p>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-6">
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 rounded-full bg-white/10 flex items-center justify-center mb-2">
                        <svg class="w-8 h-8 text-[#6EC9F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.01 12.01 0 002.944 12c.033 1.621.57 3.208 1.62 4.494.93 1.155 2.115 2.18 3.5 2.981A11.957 11.957 0 0012 21.056c1.621-.033 3.208-.57 4.494-1.62 1.155-.93 2.18-2.115 2.981-3.5A12.01 12.01 0 0021.056 12c-.033-1.621-.57-3.208-1.62-4.494-.93-1.155-2.115-2.18-2.981-3.5z"></path></svg>
                    </div>
                    <span class="text-sm font-semibold mt-1">L-Theanine (Focus)</span>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 rounded-full bg-white/10 flex items-center justify-center mb-2">
                        <svg class="w-8 h-8 text-[#6EC9F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18V6M4 12h16"></path></svg>
                    </div>
                    <span class="text-sm font-semibold mt-1">Magnesium (Calm)</span>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 rounded-full bg-white/10 flex items-center justify-center mb-2">
                        <svg class="w-8 h-8 text-[#6EC9F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 3.314-2.686 6-6 6S0 14.314 0 11c0-3.314 2.686-6 6-6s6 2.686 6 6z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 13c0-1.657-1.343-3-3-3s-3 1.343-3 3 1.343 3 3 3 3-1.343 3-3z"></path></svg>
                    </div>
                    <span class="text-sm font-semibold mt-1">B Vitamins</span>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 rounded-full bg-white/10 flex items-center justify-center mb-2">
                        <svg class="w-8 h-8 text-[#6EC9F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <span class="text-sm font-semibold mt-1">Taurine</span>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 rounded-full bg-white/10 flex items-center justify-center mb-2">
                        <svg class="w-8 h-8 text-[#6EC9F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>
                    </div>
                    <span class="text-sm font-semibold mt-1">Motherwort (Relaxation)</span>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 rounded-full bg-white/10 flex items-center justify-center mb-2">
                        <svg class="w-8 h-8 text-[#6EC9F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.01 12.01 0 002.944 12c.033 1.621.57 3.208 1.62 4.494.93 1.155 2.115 2.18 3.5 2.981A11.957 11.957 0 0012 21.056c1.621-.033 3.208-.57 4.494-1.62 1.155-.93 2.18-2.115 2.981-3.5A12.01 12.01 0 0021.056 12c-.033-1.621-.57-3.208-1.62-4.494-.93-1.155-2.115-2.18-2.981-3.5z"></path></svg>
                    </div>
                    <span class="text-sm font-semibold mt-1">Uridine</span>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW: FAQ Section to build trust -->
    <section id="faq" class="py-16 md:py-24 bg-[#3E216B]">
        <div class="container mx-auto px-4 max-w-4xl">
            <!-- H3 with keyword 'confidence supplement' -->
            <h3 class="text-center text-3xl md:text-4xl font-bold mb-12">FAQ: Get The Facts on Social Phix</h3>
            <div class="space-y-6">
                <!-- FAQ Item 1 -->
                <div class="card p-6 rounded-2xl shadow-xl">
                    <h4 class="text-xl font-semibold text-[#6EC9F1] mb-2">Is Social Phix safe to take daily?</h4>
                    <div class="faq-answer p-3 mt-3 rounded-lg">
                        <p class="text-white/80">Yes! Social Phix is formulated with non-addictive, natural, and GRAS (Generally Recognized As Safe) ingredients. We recommend daily use for cumulative mental and social benefit, but it's also perfect to take on an as-needed basis for nervousness support before stressful events.</p>
                    </div>
                </div>
                <!-- FAQ Item 2 -->
                <div class="card p-6 rounded-2xl shadow-xl">
                    <h4 class="text-xl font-semibold text-[#6EC9F1] mb-2">How long does it take for Social Phix to work?</h4>
                    <div class="faq-answer p-3 mt-3 rounded-lg">
                        <p class="text-white/80">Most people feel a noticeable difference in calmness and focus within 20-30 minutes of taking Social Phix. For best results, take it shortly before you anticipate the social interaction.</p>
                    </div>
                </div>
                <!-- FAQ Item 3 -->
                <div class="card p-6 rounded-2xl shadow-xl">
                    <!-- Compliant language: 'supports calm alertness' -->
                    <h4 class="text-xl font-semibold text-[#6EC9F1] mb-2">Will Social Phix make me feel drowsy or "out of it"?</h4>
                    <div class="faq-answer p-3 mt-3 rounded-lg">
                        <p class="text-white/80">Not at all. Social Phix is designed to help support a feeling of calm alertness and social composure. It enhances your clarity and focus by easing nervousness, not by sedating you.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Waitlist Section (Background changed to alternate) -->
    <section id="waitlist" class="py-16 md:py-24 bg-[#2D184E]">
        <div class="container mx-auto px-4 text-center">
            <!-- H3: Compliant Call to Action -->
            <h3 class="text-3xl md:text-4xl font-bold mb-4">Support Your Social Confidence with Social Phix.</h3>
            <p class="text-lg max-w-2xl mx-auto mb-2 text-white/80">Join our VIP waitlist for early access and a special launch discount. Start feeling more composed and present in social situations!</p>
            
            <!-- ENHANCEMENT: Social Proof Placeholder -->
            <p class="text-2xl font-extrabold text-[#6EC9F1] mb-8 animate-pulse">4,500+ people already choosing Social Phix for their social support!</p>
            
            <form class="max-w-xl mx-auto space-y-4">
                <input type="email" placeholder="Enter your email" required class="w-full p-4 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-[#6EC9F1]">
                <button type="submit" class="w-full bg-[#6EC9F1] text-[#2D184E] font-bold py-4 rounded-lg shadow-lg hover:bg-sky-400 transition-colors duration-300">Join Now for Confidence Support</button>
            </form>
        </div>
    </section>

    <!-- Footer with Mandatory FDA Disclaimer -->
    <footer class="p-6 md:p-8 text-center text-white/60 text-sm">
        <p class="mb-4">Social Phix is a dietary supplement.</p>
        <!-- MANDATORY FDA DISCLAIMER FOR DIETARY SUPPLEMENTS -->
        <p class="text-xs text-red-300/80 max-w-3xl mx-auto">
            These statements have not been evaluated by the Food and Drug Administration. This product is not intended to diagnose, treat, cure, or prevent any disease. Always consult with your healthcare provider before starting any new dietary supplement.
        </p>
        <p class="mt-4">&copy; 2025 Social Phix. All rights reserved. | Natural Supplement for Social Confidence and Calmness.</p>
    </footer>

    <!-- AI Logic Script: Fixed API Key -->
    <script>
        const AI_MODEL = 'gemini-2.5-flash-preview-09-2025';
        const API_BASE = 'https://generativelanguage.googleapis.com/v1beta/models/';

        // Helper function for exponential backoff retry logic
        async function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Updated: Added logic to read the response text on failure for better debugging
        async function fetchWithRetry(url, options, maxRetries = 5) {
            let lastError = null;
            for (let i = 0; i < maxRetries; i++) {
                const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                try {
                    const response = await fetch(url, options);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        // Throw a detailed error including status and response text
                        throw new Error(`HTTP error! Status: ${response.status}. Response body: ${errorText}`);
                    }
                    return response;
                } catch (error) {
                    lastError = error;
                    if (i < maxRetries - 1) {
                        // We intentionally don't log the retries to keep the console clean
                        await sleep(delay);
                    }
                }
            }
            throw new Error(`Failed to fetch after ${maxRetries} attempts. Last error details: ${lastError ? lastError.message : 'Unknown network error'}`);
        }

        async function askAI() {
            const questionInput = document.getElementById('ai-question');
            const responseArea = document.getElementById('ai-response');
            const submitButton = document.getElementById('ask-ai-button');
            
            const userQuery = questionInput.value.trim();
            if (!userQuery) {
                responseArea.innerHTML = '<p class="text-yellow-400">Please enter your question.</p>';
                return;
            }

            // --- Set Loading State ---
            submitButton.disabled = true;
            submitButton.innerHTML = 'Reflecting...';
            responseArea.innerHTML = `
                <div class="text-center py-4 space-y-2">
                    <svg class="animate-spin h-6 w-6 text-[#F1E0B3] mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="text-sm">The Assistant is searching for wisdom and encouragement...</p>
                </div>
            `;

            // *******************************************************************
            // !!! API KEY INSERTED !!!
            // The API key from your curl command has been pasted here.
            // *******************************************************************
            const userProvidedKey = "AIzaSyCwBBPzmQ24B-yz5yBRxNvzyLPSxpLIm5c"; // Your key is now here.
            
            // This logic will use your key first, but fall back to the environment key if yours is empty.
            const apiKey = userProvidedKey || (typeof __ai_api_key !== 'undefined' ? __ai_api_key : ''); 

            if (!apiKey) {
                responseArea.innerHTML = '<p class="text-red-400">Configuration Error: API Key is missing. Please paste your key into the code where marked.</p>';
                submitButton.disabled = false;
                submitButton.innerHTML = 'Receive Reflection';
                return;
            }

            const apiUrl = `${API_BASE}${AI_MODEL}:generateContent?key=${apiKey}`;

            // System prompt remains focused on Christian principles to provide the requested content.
            const systemPrompt = "You are a kind, gentle, Christian spiritual mentor and emotional support assistant. Your core mission is to share the good news of Jesus Christ by offering comfort, hope, and supportive advice to users dealing with worry, anxiety, or nervousness. Your tone must be deeply empathetic, non-judgemental, and welcoming to all, irrespective of their current beliefs. When responding: 1. Acknowledge the user's feelings with compassion. 2. Offer encouraging spiritual advice rooted in Christian principles (like peace, hope, and trust in God), often using relevant, comforting Bible verses (from a standard modern translation like NIV or KJV, but do not state the version). 3. Never be pushy, demanding, or heavy-handed; present faith suggestions as gentle, optional reflections. 4. Always maintain a soft, calming, and conversational tone. 5. Do not make medical or diagnostic claims, and never suggest replacing professional mental health or medical help. Do not mention that you are an AI assistant.";

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }], 
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const candidate = result.candidates?.[0];
                
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;
                    
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attr => ({
                                uri: attr.web?.uri,
                                title: attr.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    // Format the AI response text
                    let htmlOutput = `<div class="bg-white/10 p-4 rounded-xl shadow-inner mb-4 text-left">${text.replace(/\n/g, '<br>')}</div>`;
                    
                    if (sources.length > 0) {
                        htmlOutput += '<div class="text-xs text-white/50 mt-4 text-left">';
                        htmlOutput += '<p class="font-semibold mb-1">Sources consulted:</p>';
                        sources.forEach((source) => {
                            htmlOutput += `<p class="text-xs"><a href="${source.uri}" target="_blank" class="hover:text-[#6EC9F1] truncate block">${source.title || source.uri}</a></p>`;
                        });
                        htmlOutput += '</div>';
                    }
                    
                    responseArea.innerHTML = htmlOutput;
                } else {
                     responseArea.innerHTML = '<p class="text-red-400">Sorry, I couldn\'t generate a response. Please try rephrasing your question.</p>';
                }

            } catch (error) {
                // IMPORTANT: Logging the full error object for better diagnostics
                console.error('AI API Error (Detailed):', error);
                
                let errorMessage = 'An error occurred while connecting to the AI service. Please try again later.';
                
                // If we captured a specific HTTP error message from fetchWithRetry, use it
                if (error.message && error.message.includes('HTTP error!')) {
                    errorMessage = `Connection failed: ${error.message.substring(error.message.indexOf('Status:'))}`;
                }
                
                responseArea.innerHTML = `<p class="text-red-400">${errorMessage}</p>`;

            } finally {
                // --- Reset State ---
                submitButton.disabled = false;
                submitButton.innerHTML = 'Receive Reflection';
            }
        }

        // Add event listener on window load
        document.addEventListener('DOMContentLoaded', function() {
            const button = document.getElementById('ask-ai-button');
            const input = document.getElementById('ai-question');
            
            // Set logging level to debug for more console detail on Firestore, etc.
            if (typeof setLogLevel === 'function') {
                setLogLevel('Debug');
            }
            
            if (button) {
                button.addEventListener('click', askAI);
            }
            // Allow pressing Enter key to submit the question
            if (input) {
                input.addEventListener('keypress', function(e) {
                    const submitButton = document.getElementById('ask-ai-button');
                    if (e.key === 'Enter' && !submitButton.disabled) {
                        e.preventDefault(); // Prevent default form submit behavior
                        askAI();
                    }
                });
            }
        });
    </script>
</body>
</html>
